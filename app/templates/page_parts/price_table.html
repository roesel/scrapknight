{% macro render_table_header(header, columns, display_columns) -%}
<thead>
    <tr>
    {% for heading in header %}
        {% if columns[loop.index0] in display_columns %}
        <th class="col-md-{{ heading['width'] }}"
            data-field="{{ heading['data_field'] }}"
            data-sortable="{{ heading['data_sortable'] }}"> {{ heading['text'] }} </th>
        {% endif %}
    {% endfor %}
    </tr>
</thead>
{%- endmacro %}

{% macro render_table_body(body, columns, display_columns, show_add_to_deck_button, count_as_input) -%}
<tbody>
{% for row in body %}
    {% if row['found'] == True %}
        {% if row['multicard'] %}
            {% if row['multicard_info'] == 'similar_search' %}
                {% set row_class="warning" %}
            {% elif row['multicard_info'] == 'multiple_cards' %}
                {% set row_class="info" %}
            {% endif %}
        {% endif %}

        {% if row['multicard'] == 'head' %}
            <tr class="{{ row_class }}"
                data-toggle="collapse" data-target=".{{row['search_hash']}}"
                onmouseover="document.images.card_pic.src='{{ url_for('static',filename='img/card_back.jpg') }}'">
                <td>
                    <strong>{{row['row'][0]['name']}}</strong> &#8212; <em>Click to expand list</em> {# &#8212; is emdash #}
                    <input type="button"
                        name="acceptMulticardSelection"
                        value="Accept selection"
                        data-field="{{row['search_hash']}}"
                        class="btn btn-default btn-xs"
                        style="margin-left: 10pt;">
                </td>
        {% elif row['multicard'] == 'item' %}
            <tr class="{{row['search_hash']}} {{ row_class }} collapse out"
                onmouseover="document.images.card_pic.src='http://cernyrytir.cz/images/kusovkymagic/{{row['row'][0]['id']}}.jpg'">
                <td><span name="cardname" data-field="{{ loop.index }}{{ row['card_id'] }}">{{row['row'][0]['name']}}</span></td>
        {% else %}
            <tr class="{{row['search_hash']}}" data-field="{{row['card_id']}}"
                onmouseover="document.images.card_pic.src='http://cernyrytir.cz/images/kusovkymagic/{{row['row'][0]['id']}}.jpg'">
                <td><span name="cardname" data-field="{{ loop.index }}{{ row['card_id'] }}">{{row['row'][0]['name']}}</span>
                    {% if show_add_to_deck_button %}
                        <input type="button"
                            name="addToDeck"
                            value="Add to deck"
                            data-field="{{row['card_id']}}"
                            class="btn btn-default btn-xs pull-right"
                            style="margin-right: 10pt;">
                    {% endif%}
                </td>
        {% endif %}
                <td title="{{row['row'][1]['name']}}">
                    <span name="edition" data-field="{{ loop.index }}{{ row['card_id'] }}">{{ row['row'][1]['id'] }}</span>
                </td>
            {% if not row['multicard'] == 'head' %}
                {% if columns[2] in display_columns %}
                <td name="{{ columns[2] }}">
                    {% if count_as_input == True %}
                    <div class="input-group">
                        <span class="input-group-btn">
                            <button type="button"
                                class="btn btn-default btn-number btn-sm"
                                {% if row['row'][2]|int == 0 %}
                                disabled="disabled"
                                {% endif %}
                                data-type="minus"
                                data-field="{{ loop.index }}{{ row['card_id'] }}">
                                <span class="glyphicon glyphicon-minus"></span>
                            </button>
                        </span>
                        <input type="text"
                            name="count"
                            data-field="{{ loop.index }}{{ row['card_id'] }}"
                            class="form-control input-number input-sm"
                            value="{{ row['row'][2] }}"
                            min="0"
                            max="1000">
                        <span class="input-group-btn">
                            <button type="button"
                                class="btn btn-default btn-number btn-sm"
                                data-type="plus"
                                data-field="{{ loop.index }}{{ row['card_id'] }}">
                                <span class="glyphicon glyphicon-plus"></span>
                            </button>
                        </span>
                    </div>
                    {% else %}
                      {{ row['row'][2] }}
                    {% endif %}
                </td>
                {% endif %}

                {% if columns[3] in display_columns %}
                    <td><span name="{{ columns[3] }}" data-field="{{ loop.index }}{{ row['card_id'] }}">{{ row['row'][3] }}</span></td>
                {% endif %}

                {% if columns[4] in display_columns %}
                    <td><span name="{{ columns[4] }}" data-field="{{ loop.index }}{{ row['card_id'] }}">{{ row['row'][4] }}</span></td>
                {% endif %}

            {% else %}
                {% if columns[2] in display_columns %}
                    <td>{{ row['row'][2] }}</td>
                {% endif %}

                {% if columns[3] in display_columns %}
                    <td>{{ row['row'][3] }}</td>
                {% endif %}

                {% if columns[4] in display_columns %}
                    <td>{{ row['row'][4] }}</td>
                {% endif %}
            {% endif %}
    {% else %}
        <tr class="danger"
            onmouseover="document.images.card_pic.src='{{ url_for('static',filename='img/card_back.jpg') }}'">
            <td title="{{ row['not_found_reason']['card_name']}}" >
                {% if row['not_found_reason']['card_name'] %}
                    <strong>{{row['row'][0]['name']}}</strong>
                {% else %}
                    {{row['row'][0]['name']}}
                {% endif %}
            </td>
            <td title="{{ row['not_found_reason']['edition']}}" >
                {% if row['not_found_reason']['edition'] %}
                    <strong>{{ row['row'][1]['id'] }}</strong>
                {% else %}
                    {{ row['row'][1]['id'] }}
                {% endif %}
            </td>
        {% for cell in row['row'][2:] %}
            {% if columns[loop.index0 + 2] in display_columns %}
                <td>{{ cell }}</td>
            {% endif %}
        {% endfor %}
    {% endif %}
        </tr>
{% endfor %}
</tbody>
{%- endmacro %}

{% macro render_table_footer(footer, columns, display_columns, success) -%}
<tfoot>
{% for row in footer %}
    {% if success %}
        <tr class="success">
    {% else %}
        <tr class="danger">
    {% endif %}
    {% set colspan=display_columns | count - 1 %}
            <th colspan="{{ colspan }}">{{  row[0] }} <span style="font-weight: normal;"><em>{{  row[1] }}</em></span></th>
            <th><span name="totalprice">{{ row[2] }}</span></th>
    </tr>
{% endfor %}
</tr>
</tfoot>
{%- endmacro %}

{% macro price_table(
    name, table_data, table_id="price_table",
    display_columns=None,
    display_footer=True,
    count_as_input=True,
    show_add_to_deck_button=False,
    buttons_to_render=None)
-%}

{% if display_columns == None %}
    {% set display_columns=table_data['columns'] %}
{% endif %}

<div class="panel panel-default">
  <div class="panel-heading"><strong>{{ name }}</strong></div>
  <div class="panel-body">
    <table id="{{ table_id }}" class="table table-striped table-condensed table-hover" data-toggle="table">

      {% if table_data['header'] %}
        {{ render_table_header(table_data['header'], table_data['columns'], display_columns) }}
      {% endif %}

      {{ render_table_body(table_data['body'], table_data['columns'], display_columns, show_add_to_deck_button, count_as_input) }}

      {% if display_footer and table_data['footer'] %}
        {{ render_table_footer(table_data['footer'], table_data['columns'], display_columns, table_data['success']) }}
      {% endif %}

    </table>
    <div>
    </div>
  </div>
  <div class="panel-footer">
      {% if buttons_to_render %}
      <div class="btn-group">
          {% if 'exportCardList' in buttons_to_render %}
          <button type="button" class="btn btn-default" name="exportCardList">
              <span class="glyphicon glyphicon-export" aria-hidden="true"></span> Export
          </button>
          {% endif %}
          {% if 'saveLibrary' in buttons_to_render %}
          <button type="button" class="btn btn-default" name="saveLibrary" disabled>
              <span class="glyphicon glyphicon-floppy-disk" aria-hidden="true"></span> Save
          </button>
          {% endif %}
          {% if 'saveDeck' in buttons_to_render %}
          <button type="button" class="btn btn-default" name="saveDeck" disabled>
              <span class="glyphicon glyphicon-floppy-disk" aria-hidden="true"></span> Save
          </button>
          {% endif %}
          {% if 'deleteDeck' in buttons_to_render %}
          <button type="button" class="btn btn-default" name="deleteDeck">
              <span class="glyphicon glyphicon-remove" aria-hidden="true"></span> Delete
          </button>
          {% endif %}
      </div>
      {% endif %}
  </div>
</div>
{%- endmacro %}
